<script setup>
import "../../../assets/css/sections/contact/_contact-card.scss";
import {ref} from "vue";

defineProps({
  contactInfo: {
    type: Object,
    required: true
  },
});

function getSrc(nameFile) {
  return new URL(`../../../assets/imgs/icons/${nameFile}.svg`, import.meta.url).href;
}

const flipped = ref(false);
const card = ref(null);
const width = ref(0);
const height = ref(0);
const scale = ref(1);
const rotateX = ref('0');
const rotateY = ref('0');
const threshold = 20;

function initHover() {
  if (card.value) {
    width.value = card.value.clientWidth;
    height.value = card.value.clientHeight;
    scale.value = 1.1;
  }
}

function handleHover(e) {
  if(flipped.value) {
    return;
  }

  const layerX = e.layerX
  const layerY = e.layerY

  rotateX.value = threshold * ((layerX - width.value / 2) / width.value);
  rotateY.value = -threshold * ((layerY - height.value / 2) / height.value);
}

function resetStyles() {
  scale.value = 1;
  rotateX.value = '0';
  rotateY.value = '0';
}
</script>

<template>
  <li
    :class="[
      'contact-card',
      contactInfo.title.toLowerCase(),
      flipped ? 'contact-card--flipped' : ''
    ]"
    ref="card"
    :style="`transform: perspective(500px) scale(${scale}) rotateX(${rotateX}deg) rotateY(${rotateY}deg);`"
    @mouseenter="() => {
      if(!flipped) {
        initHover()
      }
    }"
    @mousemove="handleHover"
    @mouseleave="() => {
      if(!flipped) {
        resetStyles()
      }
    }"
  >
    <div
      class="contact-card__recto"
      @click="flipped = !flipped"
    >
      <div class="contact-card__recto-head">
        <p class="contact-card__upper-title">DÃ©couvre mon</p>
        <h3 class="contact-card__title">{{ contactInfo.title }}</h3>
      </div>
      <div class="contact-card__details">
        <svg class="contact-card__touch" xmlns="http://www.w3.org/2000/svg" width="30" height="40" viewBox="0 0 30 40" fill="none">
          <path d="M18.6846 17.9371C18.1738 17.0726 17.5919 16.6225 16.809 16.4823C16.0031 16.3399 15.3458 16.6518 14.6278 17.1835L14.5609 16.1913C14.515 15.3984 14.455 14.6063 14.3808 13.8155C14.3493 13.4995 14.3186 13.1834 14.2887 12.8672C14.1569 11.4857 14.0229 10.0623 13.7717 8.67864C13.6398 7.946 13.3007 7.13591 12.7397 6.2086C12.1327 5.20803 11.107 4.99033 10.0018 5.62668C8.997 6.20442 8.75837 7.2008 8.66208 8.00461C8.58881 8.62212 8.57835 9.25429 8.56788 9.86761L8.5616 10.1649L8.52811 11.5945C8.49043 13.2461 8.45066 14.9521 8.45275 16.633C8.45275 17.8806 8.49252 19.147 8.5302 20.3736C8.54695 20.8949 8.56369 21.4161 8.57625 21.9352L8.45066 21.8347C8.37883 21.775 8.30554 21.7171 8.23087 21.661C6.52696 20.4071 4.69955 19.9592 2.80096 20.3318C2.38457 20.4026 1.99316 20.5786 1.66383 20.8431C1.33451 21.1076 1.07818 21.4518 0.919129 21.8431C0.763379 22.2585 0.714911 22.7064 0.77821 23.1455C0.841509 23.5846 1.01453 24.0006 1.28126 24.355C1.55339 24.7067 1.86528 25.0269 2.20857 25.3116L2.31742 25.4079C3.57092 26.496 4.61391 27.8051 5.39451 29.27C6.56283 31.5124 7.78636 33.7257 9.06398 35.9077C9.4303 36.5357 10.0143 37.0506 10.4853 37.4295C11.3687 38.1412 12.4278 38.7273 13.8157 39.2674C15.0444 39.7509 16.3548 40 17.6735 40C19.1712 39.9815 20.6543 39.7032 22.0568 39.1773C23.0916 38.7896 24.0497 38.2219 24.8869 37.5006C26.4024 36.2405 27.4595 34.5219 28.1147 32.2424C28.9939 29.2156 29.3644 26.0673 29.2178 22.917C29.1545 22.0201 28.9562 21.138 28.6296 20.3004C28.424 19.6859 28.0092 19.163 27.4576 18.8229C26.906 18.4829 26.2526 18.3472 25.6112 18.4395C25.1645 18.5106 24.729 18.6394 24.3154 18.8225C24.1345 18.8934 23.9524 18.9611 23.7691 19.0256C23.407 18.1046 22.6345 17.4431 21.5837 17.1542C20.4073 16.834 19.4319 17.0956 18.6846 17.9371ZM11.5194 35.757C11.2206 35.5509 10.9605 35.2936 10.7511 34.9971C10.232 34.2409 9.75001 33.4599 9.3068 32.6569C8.64059 31.4177 8.00544 30.162 7.40194 28.8911C6.30717 26.5927 4.94864 24.8344 3.24683 23.5198C3.22676 23.5053 3.20786 23.4892 3.19031 23.4717C3.13554 23.4141 3.07971 23.3576 3.02285 23.3021C2.6984 22.9797 2.39069 22.6741 2.55605 22.1676C2.73398 21.6191 3.25101 21.5312 3.7534 21.5312H3.82666C5.66035 21.5605 7.02934 22.2408 7.89385 23.5512C8.05713 23.8359 8.17644 24.1415 8.2497 24.4597L8.32925 24.7276C8.44228 25.0939 8.62858 25.4749 9.14143 25.5231C9.56218 25.5649 9.92221 25.2488 10.0625 24.7234C10.1211 24.4932 10.1462 24.2566 10.142 24.018C10.1022 21.8829 10.0583 19.7896 10.0122 17.8073C9.99939 17.355 9.98194 16.9028 9.95989 16.4509C9.9264 15.622 9.88872 14.7679 9.90756 13.9285C9.94943 12.0718 10.0604 10.1858 10.1671 8.36047L10.1839 8.0716C10.2216 7.45409 10.3744 6.79471 11.2347 6.5833C11.7915 7.00613 12.1264 7.61108 12.2604 8.42954C12.4844 9.80481 12.633 11.0608 12.7167 12.2686C12.8339 13.9369 12.9218 15.6366 13.0056 17.2798C13.0474 18.1067 13.0935 18.9335 13.1395 19.7603C13.1605 20.1371 13.2589 20.6437 13.8638 20.7232C14.4416 20.7986 14.6592 20.3569 14.833 20.001L15.0423 19.5615C15.2412 19.0863 15.4924 18.6342 15.7896 18.2113C16.0408 17.8806 16.3653 17.7194 16.6834 17.7696C17.0121 17.822 17.2842 18.092 17.4286 18.5065C17.5375 18.8812 17.5961 19.2663 17.6045 19.6557L17.6317 20.0115C17.64 20.1455 17.6359 20.2815 17.6233 20.4155C17.6121 20.5373 17.6079 20.6596 17.6107 20.7818C17.6094 20.9487 17.6724 21.1096 17.7866 21.2312C17.9008 21.3528 18.0575 21.4258 18.2241 21.4349C18.6113 21.4873 18.8876 21.3282 18.9986 20.9891C19.0341 20.8865 19.0593 20.7839 19.0823 20.6814C19.1074 20.562 19.1409 20.4448 19.1828 20.3318L19.3126 19.9759C19.4444 19.5845 19.6056 19.2035 19.7982 18.8393C20.1038 18.3013 20.468 18.1632 21.0939 18.3516C21.8538 18.5818 22.308 19.0549 22.4441 19.7645C22.5131 20.1748 22.5508 20.5913 22.5613 21.0079L22.5759 21.2947C22.599 21.7133 22.6869 22.1215 23.1662 22.2639C23.7272 22.4313 24.0014 22.0503 24.2129 21.6798L24.2757 21.5689C24.4599 21.2319 24.6671 20.9074 24.8974 20.5997C25.2846 20.1141 25.7451 19.8713 26.1617 19.9362C26.5531 19.9948 26.8818 20.3171 27.0827 20.8425C27.4511 21.7364 27.6688 22.6846 27.7316 23.6475C27.8363 26.241 27.3632 28.7634 26.8859 30.8902C26.5662 32.2568 25.9832 33.5479 25.1695 34.6915C24.2903 35.9537 22.9423 36.881 21.163 37.4462C17.8242 38.5075 14.5776 37.9402 11.5173 35.757H11.5194Z" fill="#282826"/>
          <path d="M5.45512 5.10755C5.68119 5.18082 5.90726 5.25199 6.13124 5.32734L6.21497 5.35456L6.25683 5.22268L6.31963 5.22896C6.4318 5.25092 6.5479 5.24076 6.65455 5.19966L6.7006 5.17663C6.92458 5.06569 7.20298 4.92544 7.25741 4.7203C7.29944 4.42895 7.23073 4.13244 7.06483 3.88928C6.90636 3.69672 6.68966 3.56083 6.44732 3.50203C5.79026 3.30002 5.12549 3.12405 4.45454 2.97453C3.93332 2.86149 3.51048 3.04779 3.34721 3.46225C3.20278 3.83276 3.33674 4.32467 3.87052 4.55075C4.38756 4.76844 4.92971 4.94218 5.45512 5.10755Z" fill="#282826"/>
          <path d="M16.2731 6.09974C16.4349 6.09734 16.5928 6.05025 16.7294 5.96368C17.3365 5.57852 17.9163 5.15569 18.4669 4.69517C18.5852 4.57859 18.6704 4.43267 18.7139 4.27233C18.7258 4.23392 18.7397 4.19619 18.7557 4.1593L18.7662 4.13836V4.11743C18.7754 3.96058 18.742 3.80415 18.6693 3.66482C18.5967 3.52548 18.4877 3.40845 18.3538 3.32618C18.2172 3.26288 18.0658 3.238 17.9161 3.25423C17.7664 3.27046 17.6239 3.32717 17.504 3.41828C16.9656 3.79112 16.46 4.20919 15.9926 4.66796L15.8461 4.80193C15.5321 5.09289 15.4735 5.45502 15.6891 5.7732C15.751 5.87294 15.8373 5.95527 15.9398 6.01241C16.0424 6.06954 16.1578 6.0996 16.2752 6.09974H16.2731Z" fill="#282826"/>
          <path d="M17.8411 9.27521C17.5962 9.35475 17.3596 9.71688 17.322 9.97435C17.2675 10.3428 17.5229 10.6484 17.9478 10.7175C18.1823 10.7551 18.4188 10.7803 18.6679 10.8054L19.0154 10.8431H19.0342C19.1515 10.8284 19.275 10.82 19.4006 10.8096C19.7271 10.797 20.0495 10.7468 20.3635 10.663C20.4988 10.6004 20.6191 10.5093 20.7159 10.3958C20.8127 10.2823 20.8839 10.1493 20.9245 10.0058C20.9446 9.93617 20.9505 9.86324 20.9419 9.79132C20.9333 9.7194 20.9102 9.64995 20.8742 9.5871C20.8234 9.50575 20.7568 9.43535 20.6785 9.38C20.6001 9.32466 20.5115 9.28547 20.4179 9.26474C19.4341 9.02192 18.5905 9.02611 17.8411 9.27521Z" fill="#282826"/>
          <path d="M2.2712 9.69388C2.2419 9.89064 2.55588 10.1795 2.74637 10.2277C3.05199 10.2967 3.36388 10.3407 3.67787 10.3595C3.81602 10.3721 3.95836 10.3847 4.10908 10.4014H4.12792C4.23258 10.3909 4.34352 10.3805 4.45865 10.3742C4.7852 10.3616 5.10756 10.3135 5.42155 10.236C5.54616 10.1748 5.65242 10.0818 5.7296 9.96642C5.80678 9.85101 5.85215 9.71729 5.86113 9.57875C5.85067 9.36105 5.55133 8.99892 5.33154 8.99264C4.47227 8.96996 3.61242 9.00002 2.75684 9.08265C2.53914 9.10358 2.30469 9.47199 2.2712 9.69388Z" fill="#282826"/>
          <path d="M10.5458 2.2335C10.6211 2.80496 10.9016 3.13151 11.3203 3.13151H11.3349C11.7871 3.12104 12.1011 2.74007 12.1011 2.2021C12.0903 1.59962 12.0174 0.999858 11.8834 0.412371C11.8415 0.215605 11.5108 0 11.3119 0H11.3077C11.1857 0.0169778 11.07 0.0644294 10.9712 0.137969C10.8724 0.211509 10.7938 0.308763 10.7425 0.420744C10.653 0.71053 10.5886 1.00747 10.55 1.30828C10.5366 1.40141 10.5213 1.49423 10.5039 1.58669V1.60762L10.5165 1.8609C10.5227 2.00743 10.5311 2.12047 10.5458 2.2335Z" fill="#282826"/>
        </svg>
        <p>Tape pour retourner la carte</p>
      </div>
    </div>
    <a
      :href="contactInfo.url"
      target="_blank"
      class="contact-card__verso"
      :style="`background-color: ${contactInfo.color || 'var(--background)'}`"
    >
      <img
        class="contact-card__icon"
        :src="getSrc(contactInfo.icon)"
        :alt="contactInfo.title"
      />
      <div class="contact-card__info">
        <p class="contact-card__title">{{ contactInfo.title }}</p>
        <p class="contact-card__description">{{ contactInfo.description }}</p>
      </div>
    </a>
  </li>
</template>